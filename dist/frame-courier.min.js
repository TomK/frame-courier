!function(){"use strict";function e(e,n,t){var r,o,i,a,s;function u(){var c=Date.now()-a;c<n&&c>=0?r=setTimeout(u,n-c):(r=null,t||(s=e.apply(i,o),i=o=null))}null==n&&(n=100);var c=function(){i=this,o=arguments,a=Date.now();var c=t&&!r;return r||(r=setTimeout(u,n)),c&&(s=e.apply(i,o),i=o=null),s};return c.clear=function(){r&&(clearTimeout(r),r=null)},c.flush=function(){r&&(s=e.apply(i,o),i=o=null,clearTimeout(r),r=null)},c}e.debounce=e;var n=e;let t=null,r={};window===window.top&&a(t="",-1,window.origin);const o={LOADED:"_loaded",PROBE:"_probe",READY:"_ready",MESSAGE_RESPONSE:"_message_response"},i={};function a(e,n,t){const o={id:n,name:e};void 0!==t&&(o.origin=t),r[e]?Object.assign(r[e],o):r[e]=o}function s(e,n,r,o){return{messageId:e+":"+w(Date.now()+n+o),event:e,to:n,toOrigin:r,from:t,fromOrigin:window.origin,payload:o}}function u(e,n,t,o){const i=r[e];if(i){const r=s(n,e,i.origin,t),a=i.id<0?window.top:window.top.frames[i.id];a?c(a,i.origin,r,o):console.warn("target has been removed")}else console.warn("frame does not exist",e)}function c(e,n,t,r){r&&l(d(t.messageId),r),e.postMessage(JSON.stringify(t),n)}function l(e,n){i.hasOwnProperty(e)||(i[e]=[]),i[e].push(n)}function d(e){return o.MESSAGE_RESPONSE+":"+w(e)}if(window.addEventListener("message",e=>{if(e.isTrusted&&e.data){let n;try{n=JSON.parse(e.data)}catch(e){return}if(["event","to","toOrigin","from","fromOrigin","payload"].every(e=>n.hasOwnProperty(e))&&!("*"!==n.toOrigin&&n.toOrigin!==window.origin||null!==t&&t!==n.to)&&i.hasOwnProperty(n.event)){const t=(t,r)=>{const o=s(d(n.messageId),n.from,n.fromOrigin,t);c(e.source,e.origin,o,r)};i[n.event].forEach(r=>{r(n.payload,t,e.source,e.origin)})}}}),window===window.top){window.MutationObserver?new MutationObserver(e=>{e.forEach(e=>{Array.from(e.removedNodes).filter(e=>e.nodeType===Node.ELEMENT_NODE).forEach(e=>{f(e.matches("iframe")?[e]:e.querySelectorAll("iframe"))})})}).observe(document,{subtree:!0,childList:!0}):document.addEventListener("DOMNodeRemoved",function(e){e.target.nodeType===Node.ELEMENT_NODE&&f(e.target.matches("iframe")?[e.target]:e.target.querySelectorAll("iframe"))});const e=n(function(){document.querySelectorAll("iframe").forEach(e=>{if(e.hasAttribute("courier-name")){const n=m(e);!1!==n&&a(e.getAttribute("courier-name"),n)}});const e=w(JSON.stringify(r));Object.keys(r).filter(e=>r[e].origin).forEach(n=>{u(n,o.PROBE,"hello "+e,(t,o)=>{t==="send "+e&&o({name:n,frames:r})})})},10);function f(n){n.length&&(n.forEach(e=>{if(e.hasAttribute("courier-name")){const n=e.getAttribute("courier-name");n&&r[n]&&delete r[n]}}),e())}function m(e){for(let n=0;n<window.frames.length;n++)if(e.contentWindow===window.frames[n])return n;return!1}l(o.LOADED,(n,t,r,o)=>{document.querySelectorAll("iframe").forEach(e=>{if(e.hasAttribute("courier-name")){const n=e.getAttribute("courier-name"),t=m(e);e.contentWindow===r&&!1!==t&&a(n,t,o)}}),e()})}else{c(window.top,"*",s(o.LOADED,"","*","hello"));let e=!1;l(o.PROBE,(n,i)=>{const a=w(JSON.stringify(r)),s=n.split(" ",2);a!==s[1]&&i("send "+s[1],n=>{t=n.name,r=n.frames,e||(e=!0,document.dispatchEvent(new CustomEvent("frame-courier-ready",{detail:{name:t}})),u("",o.READY,t))})})}function w(e){let n,t,r=0;if(0===e.length)return r;for(n=0;n<e.length;n++)r=(r<<5)-r+(t=e.charCodeAt(n)),r|=0;return String(r)}var g={listen:l,send:u,name:function(){return t}};window.FrameCourier=g}();
