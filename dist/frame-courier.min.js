!function(){"use strict";function e(e,n,t){var r,o,i,a,u;function c(){var s=Date.now()-a;s<n&&s>=0?r=setTimeout(c,n-s):(r=null,t||(u=e.apply(i,o),i=o=null))}null==n&&(n=100);var s=function(){i=this,o=arguments,a=Date.now();var s=t&&!r;return r||(r=setTimeout(c,n)),s&&(u=e.apply(i,o),i=o=null),u};return s.clear=function(){r&&(clearTimeout(r),r=null)},s.flush=function(){r&&(u=e.apply(i,o),i=o=null,clearTimeout(r),r=null)},s}e.debounce=e;var n=e;function t(e,n){var t,r;if(0===n.length)return e;for(t=0,r=n.length;t<r;t++)e=(e<<5)-e+n.charCodeAt(t),e|=0;return e<0?-2*e:e}function r(e,n,o,i){var a,u=t(t(t(e,o),(a=n,Object.prototype.toString.call(a))),typeof n);if(null===n)return t(u,"null");if(void 0===n)return t(u,"undefined");if("object"==typeof n||"function"==typeof n){if(-1!==i.indexOf(n))return t(u,"[Circular]"+o);i.push(n);var c=function(e,n,t){return Object.keys(n).sort().reduce(function(e,o){return r(e,n[o],o,t)},e)}(u,n,i);if(!("valueOf"in n)||"function"!=typeof n.valueOf)return c;try{return t(c,String(n.valueOf()))}catch(e){return t(c,"[valueOf exception]"+(e.stack||e.message))}}return t(u,n.toString())}var o=function(e){return function(e,n){for(;e.length<n;)e="0"+e;return e}(r(0,e,"",[]).toString(16),8)};let i=null,a={};window===window.top&&s(i="",-1,window.origin);const u={LOADED:"_loaded",PROBE:"_probe",READY:"_ready",MESSAGE_RESPONSE:"_message_response"},c={};function s(e,n,t){const r={id:n,name:e};void 0!==t&&(r.origin=t),a[e]?Object.assign(a[e],r):a[e]=r}function f(e,n,t,r){return{messageId:e+":"+o(Date.now()+n+r),event:e,to:n,toOrigin:t,from:i,fromOrigin:window.origin,payload:r}}function l(e,n,t,r){const o=a[e];if(o){const i=f(n,e,o.origin,t),a=o.id<0?window.top:window.top.frames[o.id];a?d(a,o.origin,i,r):console.warn("target has been removed")}else console.warn("frame does not exist",e)}function d(e,n,t,r){r&&m(g(t.messageId),r),e.postMessage(JSON.stringify(t),n)}function m(e,n){c.hasOwnProperty(e)||(c[e]=[]),c[e].push(n)}function g(e){return u.MESSAGE_RESPONSE+":"+o(e)}if(window.addEventListener("message",e=>{if(e.isTrusted&&e.data){let n;try{n=JSON.parse(e.data)}catch(e){return}if(["event","to","toOrigin","from","fromOrigin","payload"].every(e=>n.hasOwnProperty(e))&&!("*"!==n.toOrigin&&n.toOrigin!==window.origin||null!==i&&i!==n.to)&&c.hasOwnProperty(n.event)){const t=(t,r)=>{const o=f(g(n.messageId),n.from,n.fromOrigin,t);d(e.source,e.origin,o,r)};c[n.event].forEach(r=>{r(n.payload,t,e.source,e.origin)})}}}),window===window.top){window.MutationObserver?new MutationObserver(e=>{e.forEach(e=>{Array.from(e.removedNodes).filter(e=>e.nodeType===Node.ELEMENT_NODE).forEach(e=>{w(e.matches("iframe")?[e]:e.querySelectorAll("iframe"))})})}).observe(document,{subtree:!0,childList:!0}):document.addEventListener("DOMNodeRemoved",function(e){e.target.nodeType===Node.ELEMENT_NODE&&w(e.target.matches("iframe")?[e.target]:e.target.querySelectorAll("iframe"))});const e=n(function(){document.querySelectorAll("iframe").forEach(e=>{if(e.hasAttribute("courier-name")){const n=O(e);!1!==n&&s(e.getAttribute("courier-name"),n)}});const e=o(JSON.stringify(a));Object.keys(a).filter(e=>a[e].origin).forEach(n=>{l(n,u.PROBE,"hello "+e,(t,r)=>{t==="send "+e&&r({name:n,frames:a})})})},10);function w(n){n.length&&(n.forEach(e=>{if(e.hasAttribute("courier-name")){const n=e.getAttribute("courier-name");n&&a[n]&&delete a[n]}}),e())}function O(e){for(let n=0;n<window.frames.length;n++)if(e.contentWindow===window.frames[n])return n;return!1}m(u.LOADED,(n,t,r,o)=>{document.querySelectorAll("iframe").forEach(e=>{if(e.hasAttribute("courier-name")){const n=e.getAttribute("courier-name"),t=O(e);e.contentWindow===r&&!1!==t&&s(n,t,o)}}),e()})}else{d(window.top,"*",f(u.LOADED,"","*","hello"));let e=!1;m(u.PROBE,(n,t)=>{const r=o(JSON.stringify(a)),c=n.split(" ",2);r!==c[1]&&t("send "+c[1],n=>{i=n.name,a=n.frames,e||(e=!0,document.dispatchEvent(new CustomEvent("frame-courier-ready",{detail:{name:i}})),l("",u.READY,i))})})}var E={listen:m,send:l,name:function(){return i}};window.FrameCourier=E}();
