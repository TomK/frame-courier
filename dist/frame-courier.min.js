!function(){"use strict";function e(e,t,n){var o,r,i,a,u;function c(){var l=Date.now()-a;l<t&&l>=0?o=setTimeout(c,t-l):(o=null,n||(u=e.apply(i,r),i=r=null))}null==t&&(t=100);var l=function(){i=this,r=arguments,a=Date.now();var l=n&&!o;return o||(o=setTimeout(c,t)),l&&(u=e.apply(i,r),i=r=null),u};return l.clear=function(){o&&(clearTimeout(o),o=null)},l.flush=function(){o&&(u=e.apply(i,r),i=r=null,clearTimeout(o),o=null)},l}e.debounce=e;var t=e;function n(e,t){var n,o;if(0===t.length)return e;for(n=0,o=t.length;n<o;n++)e=(e<<5)-e+t.charCodeAt(n),e|=0;return e<0?-2*e:e}function o(e,t,r,i){var a,u=n(n(n(e,r),(a=t,Object.prototype.toString.call(a))),typeof t);if(null===t)return n(u,"null");if(void 0===t)return n(u,"undefined");if("object"==typeof t||"function"==typeof t){if(-1!==i.indexOf(t))return n(u,"[Circular]"+r);i.push(t);var c=function(e,t,n){return Object.keys(t).sort().reduce(function(e,r){return o(e,t[r],r,n)},e)}(u,t,i);if(!("valueOf"in t)||"function"!=typeof t.valueOf)return c;try{return n(c,String(t.valueOf()))}catch(e){return n(c,"[valueOf exception]"+(e.stack||e.message))}}return n(u,t.toString())}var r=function(e){return function(e,t){for(;e.length<t;)e="0"+e;return e}(o(0,e,"",[]).toString(16),8)},i=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{}).CustomEvent;var a=function(){try{var e=new i("cat",{detail:{foo:"bar"}});return"cat"===e.type&&"bar"===e.detail.foo}catch(e){}return!1}()?i:"undefined"!=typeof document&&"function"==typeof document.createEvent?function(e,t){var n=document.createEvent("CustomEvent");return t?n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail):n.initCustomEvent(e,!1,!1,void 0),n}:function(e,t){var n=document.createEventObject();return n.type=e,t?(n.bubbles=Boolean(t.bubbles),n.cancelable=Boolean(t.cancelable),n.detail=t.detail):(n.bubbles=!1,n.cancelable=!1,n.detail=void 0),n};!function(e){if(!e.origin){var t=e.protocol+"//"+e.hostname+(e.port&&":"+e.port);try{Object.defineProperty(e,"origin",{enumerable:!0,value:t})}catch(n){e.origin=t}}}(window.location);let u=null,c={};window===window.top&&s(u="",-1,window.location.origin);const l={LOADED:"_loaded",PROBE:"_probe",READY:"_ready",MESSAGE_RESPONSE:"_message_response"},f={};function s(e,t,n){const o={id:t,name:e};void 0!==n&&(o.origin=n),c[e]?Object.assign(c[e],o):c[e]=o}function d(e,t,n,o){return o=o||null,{messageId:e+":"+r(Date.now()+t+o),event:e,to:t,toOrigin:n,from:u,fromOrigin:window.location.origin,payload:o}}function m(e,t,n,o){const r=c[e];if(r){const i=d(t,e,r.origin,n),a=r.id<0?window.top:window.top.frames[r.id];a?g(a,r.origin,i,o):console.warn("target has been removed")}else console.warn("frame does not exist",e)}function g(e,t,n,o){o&&w(p(n.messageId),o),e.postMessage(JSON.stringify(n),t)}function w(e,t){f.hasOwnProperty(e)||(f[e]=[]),f[e].push(t)}function p(e){return l.MESSAGE_RESPONSE+":"+r(e)}if(window.addEventListener("message",e=>{if(e.isTrusted&&e.data){let t;try{t=JSON.parse(e.data)}catch(e){return}if(["event","to","toOrigin","from","fromOrigin","payload"].every(e=>t.hasOwnProperty(e))&&!("*"!==t.toOrigin&&t.toOrigin!==window.location.origin||null!==u&&u!==t.to)&&f.hasOwnProperty(t.event)){const n=(n,o)=>{const r=d(p(t.messageId),t.from,t.fromOrigin,n);g(e.source,e.origin,r,o)};f[t.event].forEach(o=>{o(t.payload,n,e.source,e.origin)})}}}),window===window.top){window.MutationObserver?new MutationObserver(e=>{e.forEach(e=>{Array.from(e.removedNodes).filter(e=>e.nodeType===Node.ELEMENT_NODE).forEach(e=>{v(e.matches("iframe")?[e]:e.querySelectorAll("iframe"))})})}).observe(document,{subtree:!0,childList:!0}):document.addEventListener("DOMNodeRemoved",function(e){e.target.nodeType===Node.ELEMENT_NODE&&v(e.target.matches("iframe")?[e.target]:e.target.querySelectorAll("iframe"))});const e=t(function(){document.querySelectorAll("iframe").forEach(e=>{if(e.hasAttribute("courier-name")){const t=b(e);!1!==t&&s(e.getAttribute("courier-name"),t)}});const e=r(JSON.stringify(c));Object.keys(c).filter(e=>c[e].origin).forEach(t=>{m(t,l.PROBE,"hello "+e,(n,o)=>{n==="send "+e&&o({name:t,frames:c})})})},10);function v(t){t.length&&(t.forEach(e=>{if(e.hasAttribute("courier-name")){const t=e.getAttribute("courier-name");t&&c[t]&&delete c[t]}}),e())}function b(e){for(let t=0;t<window.frames.length;t++)if(e.contentWindow===window.frames[t])return t;return!1}w(l.LOADED,(t,n,o,r)=>{document.querySelectorAll("iframe").forEach(e=>{if(e.hasAttribute("courier-name")){const t=e.getAttribute("courier-name"),n=b(e);e.contentWindow===o&&!1!==n&&s(t,n,r)}}),e()})}else{g(window.top,"*",d(l.LOADED,"","*","hello"));let e=!1;w(l.PROBE,(t,n)=>{const o=r(JSON.stringify(c)),i=t.split(" ",2);o!==i[1]&&n("send "+i[1],t=>{u=t.name,c=t.frames,e||(e=!0,document.dispatchEvent(new a("frame-courier-ready",{detail:{name:u}})),m("",l.READY,u))})})}var y={listen:w,send:m,name:function(){return u}};window.FrameCourier=y}();
