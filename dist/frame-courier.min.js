!function(){"use strict";function e(e,t,r){var n,o,i,a,u;function c(){var s=Date.now()-a;s<t&&s>=0?n=setTimeout(c,t-s):(n=null,r||(u=e.apply(i,o),i=o=null))}null==t&&(t=100);var s=function(){i=this,o=arguments,a=Date.now();var s=r&&!n;return n||(n=setTimeout(c,t)),s&&(u=e.apply(i,o),i=o=null),u};return s.clear=function(){n&&(clearTimeout(n),n=null)},s.flush=function(){n&&(u=e.apply(i,o),i=o=null,clearTimeout(n),n=null)},s}e.debounce=e;var t=e;function r(e,t){var r,n;if(0===t.length)return e;for(r=0,n=t.length;r<n;r++)e=(e<<5)-e+t.charCodeAt(r),e|=0;return e<0?-2*e:e}function n(e,t,o,i){var a,u=r(r(r(e,o),(a=t,Object.prototype.toString.call(a))),typeof t);if(null===t)return r(u,"null");if(void 0===t)return r(u,"undefined");if("object"==typeof t||"function"==typeof t){if(-1!==i.indexOf(t))return r(u,"[Circular]"+o);i.push(t);var c=function(e,t,r){return Object.keys(t).sort().reduce((function(e,o){return n(e,t[o],o,r)}),e)}(u,t,i);if(!("valueOf"in t)||"function"!=typeof t.valueOf)return c;try{return r(c,String(t.valueOf()))}catch(e){return r(c,"[valueOf exception]"+(e.stack||e.message))}}return r(u,t.toString())}var o=function(e){return function(e,t){for(;e.length<t;)e="0"+e;return e}(n(0,e,"",[]).toString(16),8)},i=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{}).CustomEvent;var a=function(){try{var e=new i("cat",{detail:{foo:"bar"}});return"cat"===e.type&&"bar"===e.detail.foo}catch(e){}return!1}()?i:"undefined"!=typeof document&&"function"==typeof document.createEvent?function(e,t){var r=document.createEvent("CustomEvent");return t?r.initCustomEvent(e,t.bubbles,t.cancelable,t.detail):r.initCustomEvent(e,!1,!1,void 0),r}:function(e,t){var r=document.createEventObject();return r.type=e,t?(r.bubbles=Boolean(t.bubbles),r.cancelable=Boolean(t.cancelable),r.detail=t.detail):(r.bubbles=!1,r.cancelable=!1,r.detail=void 0),r};!function(e){if(!e.origin){var t=e.protocol+"//"+e.hostname+(e.port&&":"+e.port);try{Object.defineProperty(e,"origin",{enumerable:!0,value:t})}catch(r){e.origin=t}}}(window.location);class u{static fromObject(e){const t=new this.prototype.constructor;return Object.assign(t,e),t}constructor(e,t,r,n){"string"==typeof(t=t||[])?t=t.split(/\s+/):Array.isArray(t)||(console.warn("invalid tags for frame",{id:e,tags:t}),t=[]),this._id=e,this._tags="string"==typeof t?t.split(/\s+/):t,this._frameNumber=r,this._origin=n}get id(){return this._id}get tags(){return this._tags}get frameNumber(){return this._frameNumber}setFrameNumber(e){return this._frameNumber=e,this}get origin(){return this._origin}}let c=null,s={};const f={LOADED:"_frame_courier--loaded",PROBE:"_frame_courier--probe",READY:"_frame_courier--ready",MESSAGE_RESPONSE:"_frame_courier--message-response"},l={};function d(e){if(!s[e.id])return s[e.id]=e,e;console.warn("cannot add two frames with the same id")}function m(e,t,r,n){return n=n||null,{messageId:e+":"+o(Date.now()+t+n),event:e,to:t,toOrigin:r,from:c,fromOrigin:window.location.origin,payload:JSON.stringify(n)}}function g(e,t,r,n,o){const i=s[e];if(!i)throw{message:"frame does not exist",data:e};if(o&&o!==i.origin)throw{message:"target origin does not match",data:e};{const o=m(t,e,i.origin,r),a=i.frameNumber<0?window.top:window.top.frames[i.frameNumber];if(!a)throw{message:"target window is not accessible",data:e};h(a,i.origin,o,n)}}function b(e,t,r,n){Object.values(s).forEach(o=>{o.id!==c&&g(o.id,e,t,r,n)})}function h(e,t,r,n){n&&w(p(r.messageId),n),e.postMessage(JSON.stringify(r),t)}function w(e,t){l.hasOwnProperty(e)||(l[e]=[]),l[e].push(t)}function p(e){return f.MESSAGE_RESPONSE+":"+o(e)}if(window.addEventListener("message",e=>{if(e.data){let t;try{t=JSON.parse(e.data)}catch(e){return}if(["event","to","toOrigin","from","fromOrigin","payload"].every(e=>t.hasOwnProperty(e))&&!("*"!==t.toOrigin&&t.toOrigin!==window.location.origin||null!==c&&c!==t.to)){const r=JSON.parse(t.payload);if(l.hasOwnProperty(t.event)){const n=(r,n)=>{const o=m(p(t.messageId),t.from,t.fromOrigin,r);h(e.source,e.origin,o,n)};l[t.event].forEach(t=>{t(r,n,e.source,e.origin)})}}}}),window===window.top){c="",d(new u("",[],-1,window.location.origin)),window.MutationObserver?new MutationObserver(e=>{e.forEach(e=>{Array.from(e.removedNodes).filter(e=>e.nodeType===Node.ELEMENT_NODE).forEach(e=>{y(e.matches("iframe")?[e]:e.querySelectorAll("iframe"))})})}).observe(document,{subtree:!0,childList:!0}):document.addEventListener("DOMNodeRemoved",(function(e){e.target.nodeType===Node.ELEMENT_NODE&&y(e.target.matches("iframe")?[e.target]:e.target.querySelectorAll("iframe"))}));const e=t((function(){document.querySelectorAll("iframe").forEach(e=>v(e));const e=o(JSON.stringify(s));Object.keys(s).filter(e=>s[e].origin).forEach(t=>{g(t,f.PROBE,"hello "+e,(r,n)=>{r==="send "+e&&n({frameId:t,frames:s})})})}),10);function y(t){t.length&&(t.forEach(e=>{if(e.hasAttribute("courier-id")){const t=e.getAttribute("courier-id");t&&s[t]&&delete s[t]}}),e())}function v(e,t){if(!e.hasAttribute("courier-id")){if(!t)return;e.setAttribute("courier-id","frame-"+parseInt(Math.random().toFixed(16).slice(2,19)).toString(36))}const r=e.getAttribute("courier-id"),n=e.getAttribute("courier-tags"),o=function(e){for(let t=0;t<window.frames.length;t++)if(e.contentWindow===window.frames[t])return t;return!1}(e),i=s[r];i?i.setFrameNumber(o):t&&d(new u(r,n,o,t))}w(f.LOADED,(t,r,n,o)=>{document.querySelectorAll("iframe").forEach(e=>{e.contentWindow===n&&v(e,o)}),e()})}else{h(window.top,"*",m(f.LOADED,"","*","hello"));let e=!1;w(f.PROBE,(t,r)=>{const n=o(JSON.stringify(s)),i=t.split(" ",2);n!==i[1]&&r("send "+i[1],t=>{c=t.frameId,s={},Object.values(t.frames).forEach(e=>d(u.fromObject(e))),e||(e=!0,document.dispatchEvent(new a("frame-courier-ready",{detail:{frameId:c}})),b(f.READY,c))})})}const O={send:g,sendToTag:function(e,t,r,n,o){Object.values(s).forEach(i=>{i.tags.indexOf(e)>-1&&g(i.id,t,r,n,o)})},broadcast:b,id:function(){return c},tags:function(){return s[c].tags},listen:w,events:f,frames:s};window.FrameCourier=O}();
