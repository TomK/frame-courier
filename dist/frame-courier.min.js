!function(){"use strict";function e(e){let t,n,r=0;if(0===e.length)return r;for(t=0;t<e.length;t++)r=(r<<5)-r+(n=e.charCodeAt(t)),r|=0;return String(r)}let t=null,n={};window===window.top&&i(t="",-1,window.origin);const r={LOADED:"_loaded",PROBE:"_probe",READY:"_ready",MESSAGE_RESPONSE:"_message_response"},o={};function i(e,t,r){const o={id:t,name:e};void 0!==r&&(o.origin=r),n[e]?Object.assign(n[e],o):n[e]=o}function a(n,r,o,i){return{messageId:n+":"+e(Date.now()+r+i),event:n,to:r,toOrigin:o,from:t,fromOrigin:window.origin,payload:i}}function s(e,t,r,o){const i=n[e];if(i){const n=a(t,e,i.origin,r);c(i.id<0?window.top:window.top.frames[i.id],i.origin,n,o)}else console.warn("frame does not exist",e)}function c(e,t,n,r){r&&d(f(n.messageId),r),e.postMessage(JSON.stringify(n),t)}function d(e,t){o.hasOwnProperty(e)||(o[e]=[]),o[e].push(t)}function f(t){return r.MESSAGE_RESPONSE+":"+e(t)}if(window.addEventListener("message",e=>{if(e.isTrusted&&e.data){let n;try{n=JSON.parse(e.data)}catch(e){return}if(["event","to","toOrigin","from","fromOrigin","payload"].every(e=>n.hasOwnProperty(e))&&!("*"!==n.toOrigin&&n.toOrigin!==window.origin||null!==t&&t!==n.to)&&o.hasOwnProperty(n.event)){const t=(t,r)=>{const o=a(f(n.messageId),n.from,n.fromOrigin,t);c(e.source,e.origin,o,r)};o[n.event].forEach(r=>{r(n.payload,t,e.source,e.origin)})}}}),window===window.top){function u(e){e.length&&(e.forEach(e=>{if(e.hasAttribute("courier-name")){const t=e.getAttribute("courier-name");t&&n[t]&&delete n[t]}}),l())}function m(e){for(let t=0;t<window.frames.length;t++)if(e.contentWindow===window.frames[t])return t;return!1}function l(){document.querySelectorAll("iframe").forEach(e=>{if(e.hasAttribute("courier-name")){const t=m(e);!1!==t&&i(e.getAttribute("courier-name"),t)}});const t=e(JSON.stringify(n));Object.keys(n).filter(e=>n[e].origin).forEach(e=>{s(e,r.PROBE,"hello "+t,(r,o)=>{r==="send "+t&&o({name:e,frames:n})})})}window.MutationObserver?new MutationObserver(e=>{e.forEach(e=>{Array.from(e.removedNodes).filter(e=>e.nodeType===Node.ELEMENT_NODE).forEach(e=>{u(e.matches("iframe")?[e]:e.querySelectorAll("iframe"))})})}).observe(document,{subtree:!0,childList:!0}):document.addEventListener("DOMNodeRemoved",function(e){e.target.nodeType===Node.ELEMENT_NODE&&u(e.target.matches("iframe")?[e.target]:e.target.querySelectorAll("iframe"))}),d(r.LOADED,(e,t,n,r)=>{document.querySelectorAll("iframe").forEach(e=>{if(e.hasAttribute("courier-name")){const t=e.getAttribute("courier-name"),o=m(e);e.contentWindow===n&&!1!==o&&i(t,o,r)}}),l()})}else{c(window.top,"*",a(r.LOADED,"","*","hello"));let o=!1;d(r.PROBE,(i,a)=>{const c=e(JSON.stringify(n)),d=i.split(" ",2);c!==d[1]&&a("send "+d[1],e=>{t=e.name,n=e.frames,o||(o=!0,document.dispatchEvent(new CustomEvent("frame-courier-ready",{detail:{name:t}})),s("",r.READY,t))})})}var w={listen:d,send:s,name:function(){return t}};window.FrameCourier=w}();
